<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Pollen Dashboard</title>

  <!-- Link to external CSS file -->
  <link rel="stylesheet" href="style.css">

  <!-- Link to Chart.js from CDN (needed for graphing) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet.js CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet.js JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>



  <main class="container">
    <div class="card">
      <h1>Current pollen estimate</h1>
      <div class="pollen_estimate_container">
        <div>Particles per m³/t</div>
        <div id="pollen_estimate">loading...</div>
        <div id="pollen_level">loading...</div> <!-- Text for pollen level -->
      </div>
    </div>


    <div class="card">
      <h1>Last update</h1> 

      <center>
        <div class="mode-toggle">
          <button id="dailyBtn" class="mode-btn active">Daily</button>
          <button id="hourlyBtn" class="mode-btn">Hourly</button>
        </div>
      </center>
      
    
      <div id="averagesDisplay"></div>
      <div class="dropdown-container">
        <button id="togglePollenBox" class="dropdown-toggle">Show Pollen Info</button>
      
        <div id="pollenBox" class="dropdown-box hidden">
          
            <span>Historical data from pollendata</span>
            <p id="pollenCount">Loading pollen count...</p>
            <canvas id="pollenChart"></canvas>
         
        </div>
      </div>
    </div>
    
<div class="card">
  <h1>Pollen Dashboard</h1>
    <div class="dashboard">
      <!-- Left Panel -->
      <div class="side-panel">
        <section class="card">
          <div class="filter-controls-header">
            <h2>Image History</h2>
            <span style="margin-left: auto;">Load latest</span>
            <label style="margin-left: auto;" class="switch">
              <input type="checkbox" id="toggleButton" onclick="toggleLoadLatest()" checked>
              <span class="slider round"></span>
            </label>
          </div>


          <div class="filter-controls">
            <div class="filter-item">
              <label for="fromDate">From:</label>
              <input type="datetime-local" id="fromDate">
            </div>
            <div class="filter-item">
              <label for="fromDate">Until:</label>
              <input type="datetime-local" id="untilDate">
              <button onclick="loadFilteredImages()">Filter</button>
            </div>
            

            
          </div>


          <div id="imageHistory"></div>
        </section>
      </div>

      <div style="position: relative; display: inline-block;" class="image-wrapper">
        <img id="latestImage" alt="Latest Pollen Image" style="width: 100%; display: block;" />
        <canvas id="boundingCanvas" style="position: absolute; top: 0; left: 0; pointer-events: none;"></canvas>
        <p id="status" class="image-status-top">Loading image...</p>
      
        <div class="toggle-wrapper">
          <span class="toggle-label">BBox Toggle</span>
          <label class="switch">
            <input type="checkbox" id="toggleBoxes" onclick="toggleBoundingBoxes()" checked>
            <span class="slider round"></span>
          </label>
        </div>
      </div>
    </div>
      
    </div>



      <!-- Temp & Humidity  -->
       <div class="card">
      <h1>Temprature & Humidity </h1>
    
      <div id="charts-container">


        <div id="tempChartContainer">
          <section class="card">
            <p id="latestTemp">Latest Temp: --°C</p>
            <canvas id="tempChart"></canvas>
          </section>
        </div>



        <div id="humidityChartContainer">
          <section class="card">
            <p id="latestHumidity">Latest Humidity: --%</p>
            <canvas id="humidityChart"></canvas>
          </section>
        </div>
      </div>
    </div>

      <!-- GPS -->
      <div class="card">
      <h1>GPS </h1>

      <div id="gpsCardContainer" >
        <section class="card">
          <h3>GPS Coordinates</h3>
          <p id="gpsStatus">Loading GPS data...</p>
          <div id="map" style="height: 400px;"></div> <!-- Map container -->
        </section>
      </div>
    </div>



  </main>>
  <script src="TempHumidityGPS.js"></script>
  <script src="script.js"></script>
</body>

